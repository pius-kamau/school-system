<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance Reports</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">School System</a>
            <div class="navbar-nav">
                <a class="nav-link" href="/attendance/dashboard">‚Üê Back to Dashboard</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <h1>Monthly Attendance Report</h1>
        
        <form method="get" class="row mb-4">
            <div class="col-md-3">
                <label>Month:</label>
                <select name="month" class="form-control">
                    <% for(let m = 1; m <= 12; m++) { %>
                    <option value="<%= m %>" <%= m == month ? 'selected' : '' %>>
                        <%= new Date(2000, m-1).toLocaleString('default', {month: 'long'}) %>
                    </option>
                    <% } %>
                </select>
            </div>
            <div class="col-md-3">
                <label>Year:</label>
                <input type="number" name="year" value="<%= year %>" class="form-control">
            </div>
            <div class="col-md-3">
                <label>&nbsp;</label><br>
                <button type="submit" class="btn btn-primary">Generate Report</button>
            </div>
        </form>

        <table class="table">
            <thead>
                <tr>
                    <th>Student</th>
                    <th>Class</th>
                    <th>Present Days</th>
                    <th>Absent Days</th>
                    <th>Late Days</th>
                    <th>Attendance %</th>
                </tr>
            </thead>
            <tbody>
                <% if (report.length === 0) { %>
                <tr>
                    <td colspan="6" class="text-center">No data for selected period</td>
                </tr>
                <% } %>
                <% report.forEach(student => { 
                    const totalDays = (student.present_days || 0) + (student.absent_days || 0) + (student.late_days || 0);
                    const percentage = totalDays > 0 ? Math.round((student.present_days / totalDays) * 100) : 0;
                %>
                <tr>
                    <td><%= student.name %></td>
                    <td><%= student.class %></td>
                    <td><%= student.present_days || 0 %></td>
                    <td><%= student.absent_days || 0 %></td>
                    <td><%= student.late_days || 0 %></td>
                    <td>
                        <div class="progress">
                            <div class="progress-bar <%= percentage >= 80 ? 'bg-success' : percentage >= 60 ? 'bg-warning' : 'bg-danger' %>" 
                                 style="width: <%= percentage %>%">
                                <%= percentage %>%
                            </div>
                        </div>
                    </td>
                </tr>
                <% }); %>
            </tbody>
        </table>
    </div>
</body>
</html>